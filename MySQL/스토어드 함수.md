# 스토어드 함수

> RETURN이 있어야 한다.
>
> SELECT 사용 X
>
> 어떤 계산된 값을 반환할 때 주로 사용한다.



### 스토어드 함수 생성 및 호출 문법

> 스토어드 함수를 생성하기 위해서는 먼저 스토어드 함수 생성 권한을 허용해줘야 한다.

```sql
SET GLOBAL log_bin_trust_function_creators = 1;
```



### 생성 및 호출

```sql
DELIMITER $$
CREATE FUNCTION function_name (param1 type1, param2 type2, ...) 
RETURNS return_type -- 어떤 타입으로 반환할지 입력 (INT, CHAR...)
BEGIN 
    -- Function code here 
END $$
DELIMITER ; 

SELECT function_name(param1, param2...); -- 함수 호출
```

### 예제1

```sql
DELIMITER $$
CREATE FUNCTION get_avg (x INT, y INT) 
RETURNS INT 
BEGIN 
    DECLARE avg INT;
    SET avg = (x + y) / 2;
    RETURN avg;
END $$
DELIMITER ; 

SELECT get_avg(10, 20); -- 결과: 15
```

### 예제2

```sql
SET GLOBAL log_bin_trust_function_creators = 1; -- 스토어드 함수 생성 권한 활성화

DROP FUNCTION IF EXISTS getage;

DELIMITER $$
CREATE FUNCTION getage (bYear INT)
	RETURNS INT
BEGIN
	DECLARE age INT;
    SET age = YEAR(CURDATE())-bYear; -- 현재 날짜의 연도 - 입력으로 오는 연도
    RETURN age;
END $$
DELIMITER ;
SELECT getage(1996); -- 내 만나이가 나온다.

-- 함수의 값을 변수에 저장할 수 있다.
SELECT getage(1996) INTO @age1996
SELECT getage(1990) INTO @age1990
SELECT CONCAT('1996년생과 1990년생의 나이차이 : '(@age1990-@age1996)
```



#### 집합 결과에 모두 함수 적용

```sql
-- 집합결과에 모두 함수 적용
select userID,name, birthYear from usertbl;
```

![image-20230308174139846](%EC%8A%A4%ED%86%A0%EC%96%B4%EB%93%9C%20%ED%95%A8%EC%88%98.assets/image-20230308174139846.png)

```sql
select userID,name, getage(birthYear) AS '만 나이' from usertbl;
```

![image-20230308174225278](%EC%8A%A4%ED%86%A0%EC%96%B4%EB%93%9C%20%ED%95%A8%EC%88%98.assets/image-20230308174225278.png)



## 함수 정보 확인

```sql
SHOW CREATE FUNCTION 함수이름;
```

